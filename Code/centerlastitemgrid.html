<style>
  html {
    color-scheme: dark;
    font-size: 16px;
    box-sizing: border-box;
  }

  .item {
    height: 150px;
    background: hsl(340 80% 50%);
    border: 5px solid hsl(340 80% 70%);
    border-radius: 1rem;
  }

  .grid-container {
    max-width: 65rem;
    margin-inline: auto;
    margin-block: 6rem;
    container-type: inline-size;
  }

  /* Trong safari bị lỗi với repeat auto-fit + max-width nó k chiếm kích thước, buộc phải bao ngoài bằng 1 grid-container xác định kích thước */
  /* Safari bị lỗi container-query nên vẫn bị sai ở 1 vài kích thước màn hình */
  .grid {
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    
    /* Cơ chế giống cơ chế tạo masonry layout với grid. Chiều ngang ta để 1 card chiếm x2 kích thước và mỗi vị trí đều phải căn lại các card cuối cùng */
    /* Có thể chọn các card cuối cùng bằng css selector bh rất mạnh */

    /* Nhìn thấy 1 cột */
    /* Trong css có thể dùng calc cho @container, nhưng k được dùng css var nên buộc phải fix cứng từng mốc */
    @container (width >= calc(100px * 2 + 1rem)) {
      .item {
        grid-column: span 2;
      }
    }

    /* Nhìn thấy 2 cột */
    @container (calc(100px * 4 + 3rem) <= width < calc(100px * 6 + 5rem) ) {
      /* Selector lấy phần tử cuối cùng nếu là số chẵn */
      .item:last-child:nth-child(odd) {
        grid-column: 2 / span 2;
      }
    }
    
    /* Nhìn thấy 3 cột */
    /* Phải chặn cả đầu và cuối để tránh kích thước lớn hơn nó lại lấy style này */
    @container (calc(100px * 6 + 5rem) < width < calc(100px * 8 + 7rem)) {
      /* Phần tử cuối cùng là phần tử thoả mãn ở vị trí 3n+4 với n nguyên */
      .item:nth-child(3n + 4):last-child {
        grid-column: 3 / 5;
      }
      .item:nth-child(3n+4):nth-last-child(2) {
        grid-column: 2 / 4;
      }
      .item:nth-child(3n+5):last-child {
        grid-column: 4 / 6;
      }
    }

    /* Nhìn thấy 4 cột */
    @container (calc(100px * 8 + 7rem) < width < calc(100px * 10 + 9rem)) {
      /* Khi hàng cuối có 1 */
      .item:nth-child(4n + 1):last-child {
        grid-column: 4 / 6;
      }
      /* Khi hang cuối có 2 */
      .item:nth-child(4n+1):nth-last-child(2) {
        grid-column: 3 / 5;
      }
      .item:nth-child(4n+2):last-child {
        grid-column: 5 / 7;
      }
      /* Khi hàng cuối có 3 */
      .item:nth-child(4n+1):nth-last-child(3) {
        grid-column: 2 / 4;
      }
      .item:nth-child(4n+2):nth-last-child(2) {
        grid-column: 4 / 6;
      }
      .item:nth-child(4n+3):last-child {
        grid-column: 6 / 8;
      }
    }
  }
</style>

<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>
<div class="grid-container">
  <div class="grid">
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
    <div class="item"></div>
  </div>
</div>